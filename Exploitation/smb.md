#Reference
https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb

---

# Rapid

Samba 3.0.0 - 3.0.25rc3

- [CVE-2007-2447 - Samba usermap script] (https://amriunix.com/post/cve-2007-2447-samba-usermap-script/) Surefire.

# Diffrerence port 139 and 445

> On Windows, SMB can run directly over TCP/IP without the need for NetBIOS over TCP/IP. This will use, as you point out, port 445.
> Generally speaking, on other systems, you'll find services and applications using port 139. This, basically speaking, means that SMB is running with NetBIOS over TCP/IP, where, stack-wise, SMB is on top of NetBIOS if you are to imagine it with the OSI model.

> Port 139: SMB originally ran on top of NetBIOS using port 139. NetBIOS is an older transport layer that allows Windows computers to talk to each other on the same network.  
> Port 445: Later versions of SMB (after Windows 2000) began to use port 445 on top of a TCP stack. Using TCP allows SMB to work over the internet.

# Basic Command

- Scan a network

```sh
nbtscan -r 192.168.0.1/24
```

- Obtaining information

```sh
nmap --script "safe or smb-enum-*" -p 445 10.10.10.3
#Connect to the rpc with no creds
rpcclient -U "" -N <IP>
```

- show shared folders

```sh
# NULL User
smbclient --no-pass -L // <IP>
#Connect using smbclient
smbclient --no-pass //<IP>/<Folder>
```

- Download all files

```sh
smbclient //<IP>/<share>
mask ""
recurse
prompt
mget *
```
